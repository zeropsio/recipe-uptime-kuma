zerops:
  - setup: app
    build:
      base: nodejs@18
      buildCommands:
        - git clone https://github.com/louislam/uptime-kuma temp_dir && \mv temp_dir/* temp_dir/.[!.]* ./ || true && \rm -rf temp_dir
        - npm ci
        - npm run build
        - npm run download-dist --production
      deployFiles:
        - ./
    run:
      base: nodejs@18
      envVariables:
        UPTIME_KUMA_DB_TYPE: mariadb
        UPTIME_KUMA_DB_HOSTNAME: db
        UPTIME_KUMA_DB_PORT: ${db_port}
        UPTIME_KUMA_DB_NAME: db
        UPTIME_KUMA_DB_USERNAME: db
        UPTIME_KUMA_DB_PASSWORD: ${db_password}
      ports:
        - port: 3001
          httpSupport: true
      start: node server/server.js
